#!/bin/bash

AWS_PROFILE="--profile nephoeng"


STACK_CREATE="aws --profile=nephoeng cloudformation create-stack"
OPTIONS=" --disable-rollback  --capabilities CAPABILITY_IAM "

NAME="BeesAttack"
TEMPLATE_FILE=cloudformation-templates/template.json

P="   ParameterKey=KeyName,ParameterValue=parrott-ec2"

P="$P ParameterKey=BeesControllerInstanceType,ParameterValue=m1.small"

P="$P ParameterKey=Target2Sting,ParameterValue=${1}"

P="$P ParameterKey=AZ2,ParameterValue=us-east-1c"
P="$P ParameterKey=AZ3,ParameterValue=us-east-1d"
P="$P ParameterKey=VPCId,ParameterValue=vpc-48a8732d"
P="$P ParameterKey=PubSubnet1,ParameterValue=subnet-3581646c"
P="$P ParameterKey=PubSubnet2,ParameterValue=subnet-f10b0ed9"
P="$P ParameterKey=PubSubnet3,ParameterValue=subnet-e943bb9e"
P="$P ParameterKey=PrivSubnet1,ParameterValue=subnet-3281646b"
P="$P ParameterKey=PrivSubnet2,ParameterValue=subnet-f20b0eda"
P="$P ParameterKey=PrivSubnet3,ParameterValue=subnet-e843bb9f"
P="$P ParameterKey=NATInstanceIP,ParameterValue=54.209.158.101"

P="$P ParameterKey=WebAdminIP,ParameterValue=54.210.46.70"
P="$P ParameterKey=WebAdminEIPId,ParameterValue=eipalloc-969e5ef3"

P="$P ParameterKey=BucketAdminARN,ParameterValue=arn:aws:iam::219880708180:user/robparrott"

P="$P ParameterKey=CodeBucket,ParameterValue=cloud-boot-camp-hwp-devops"
P="$P ParameterKey=CodeFolder,ParameterValue=www-harvard-edu"
P="$P ParameterKey=Environment,ParameterValue=stage"

rm -f tmp.json
cat ${TEMPLATE_FILE} | \
   ./other-helper-scripts/remove_object - "Resources" "Distribution" | \
   ./other-helper-scripts/remove_object - "Resources" "DistributionMedia" | \
   ./other-helper-scripts/remove_object - "Outputs"   "CloudFrontURL" > tmp.json
CMD="$STACK_CREATE $OPTIONS --stack-name ${NAME} --parameters ${P} --template-body file://tmp.json"
echo $CMD
$CMD
